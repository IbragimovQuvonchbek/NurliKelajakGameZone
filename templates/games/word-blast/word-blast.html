{% extends 'base.html' %}
{% load static %}

{% block title %}So'z Portlashi - Nurli Kelajak Oʻyinlar Zonasi{% endblock %}

{% block extra_css %}
<style>
    .game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        padding: 10px;
    }

    .game-header {
        text-align: center;
        margin-bottom: 20px;
    }

    .game-header h1 {
        color: #6f42c1;
        margin-bottom: 10px;
        font-size: clamp(1.5rem, 4vw, 2.5rem);
    }

    .difficulty-selector {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .difficulty-btn {
        padding: 8px 16px;
        border: 2px solid #6f42c1;
        background: white;
        color: #6f42c1;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        font-size: 14px;
    }

    .difficulty-btn:hover {
        background: #f0f0f0;
    }

    .difficulty-btn.active {
        background: #6f42c1;
        color: white;
    }

    canvas {
        border: 3px solid #6f42c1;
        border-radius: 8px;
        background: white;
        max-width: 100%;
        height: auto;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        touch-action: none;
    }

    .game-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        width: 100%;
    }

    .game-btn {
        padding: 12px 24px;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        flex: 1;
        min-width: 140px;
        max-width: 200px;
    }

    .btn-start {
        background: #28a745;
        color: white;
    }

    .btn-start:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .btn-home {
        background: #6c757d;
        color: white;
    }

    .btn-home:hover {
        background: #5a6268;
    }

    .mobile-controls {
        display: none;
        flex-direction: column;
        gap: 10px;
        width: 100%;
        max-width: 400px;
        margin-top: 20px;
    }

    .virtual-keyboard {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 5px;
        margin-bottom: 10px;
    }

    .keyboard-btn {
        padding: 12px 8px;
        border: 2px solid #6f42c1;
        background: white;
        color: #6f42c1;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        font-size: 16px;
        text-align: center;
        transition: all 0.2s ease;
    }

    .keyboard-btn:active {
        background: #6f42c1;
        color: white;
        transform: scale(0.95);
    }

    .action-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }

    .action-btn {
        padding: 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        font-size: 14px;
        transition: all 0.2s ease;
    }

    .btn-backspace {
        background: #dc3545;
        color: white;
    }

    .btn-enter {
        background: #28a745;
        color: white;
    }

    .action-btn:active {
        transform: scale(0.95);
    }

    .game-info {
        text-align: center;
        color: #666;
        font-size: 14px;
        margin-top: 20px;
        padding: 0 10px;
    }

    .score-display {
        font-size: 18px;
        font-weight: bold;
        color: #6f42c1;
        margin: 10px 0;
    }

    /* Mobile styles */
    @media (max-width: 768px) {
        .mobile-controls {
            display: flex;
        }

        .game-btn {
            padding: 10px 20px;
            font-size: 14px;
        }

        .keyboard-btn {
            padding: 10px 5px;
            font-size: 14px;
        }

        canvas {
            max-height: 50vh;
        }
    }

    @media (max-width: 480px) {
        .virtual-keyboard {
            grid-template-columns: repeat(5, 1fr);
        }

        .keyboard-btn {
            padding: 8px 4px;
            font-size: 12px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="game-container">
    <div class="game-header">
        <h1><i class="fas fa-spell-check me-2"></i>So'z Portlashi</h1>
        <p class="text-muted">Vaqt chеgarasi ichida harflarni shakllantirish uchun so'zlarni tartiblashtiringiz!</p>
        <div class="score-display" id="currentScore">Ball: 0</div>
    </div>

    <div class="difficulty-selector">
        <button class="difficulty-btn active" onclick="setDifficulty('easy')">
            <i class="fas fa-leaf me-2"></i>Oson
        </button>
        <button class="difficulty-btn" onclick="setDifficulty('medium')">
            <i class="fas fa-star me-2"></i>O'rta
        </button>
        <button class="difficulty-btn" onclick="setDifficulty('hard')">
            <i class="fas fa-fire me-2"></i>Qiyin
        </button>
    </div>

    <div style="width: 100%; max-width: 800px;">
        <canvas id="gameCanvas" width="800" height="600" data-difficulty="easy"></canvas>
    </div>

    <!-- Mobile Controls -->
    <div class="mobile-controls" id="mobileControls">
        <div class="virtual-keyboard" id="virtualKeyboard">
            <!-- Keyboard will be generated by JavaScript -->
        </div>
        <div class="action-buttons">
            <button class="action-btn btn-backspace" onclick="gameInstance.removeLetter()">
                <i class="fas fa-backspace me-2"></i>O'chirish
            </button>
            <button class="action-btn btn-enter" onclick="gameInstance.submitWord()">
                <i class="fas fa-paper-plane me-2"></i>Yuborish
            </button>
        </div>
    </div>

    <div class="game-controls">
        <button class="game-btn btn-start" onclick="startGame()">
            <i class="fas fa-play me-2"></i>O'yinni Boshlash
        </button>
        <button class="game-btn btn-home" onclick="window.location.href='{% url 'games:home' %}'">
            <i class="fas fa-home me-2"></i>Bosh Sahifaga
        </button>
    </div>

    <div class="game-info">
        <p><strong>Ko'rsatmalar:</strong></p>
        <p>Kompyuter: Klaviaturadan harflarni yozing. Yuborish uchun Enter, o'chirish uchun Backspace.</p>
        <p>Telefon: Yuqoridagi tugmalar yordamida harflarni tanlang.</p>
    </div>
</div>

<script src="{% static 'js/animations.js' %}"></script>
<script src="{% static 'games/js/word_blast.js' %}"></script>
<script>
    let currentDifficulty = 'easy';
    let gameInstance = null;

    function setDifficulty(difficulty) {
        currentDifficulty = difficulty;
        document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        // Reinitialize game with new difficulty
        const canvas = document.getElementById('gameCanvas');
        canvas.dataset.difficulty = difficulty;
        gameInstance = new WordBlast('gameCanvas', difficulty);

        // Update mobile keyboard
        if (gameInstance) {
            gameInstance.createVirtualKeyboard();
        }
    }

    function startGame() {
        if (gameInstance) {
            gameInstance.startGame();
        }
    }

    function updateScoreDisplay(score) {
        const scoreElement = document.getElementById('currentScore');
        if (scoreElement) {
            scoreElement.textContent = `Ball: ${score}`;
        }
    }

    // Initialize game on page load
    document.addEventListener('DOMContentLoaded', () => {
        window.gameSlug = 'word-blast';
        // Initialize game with default difficulty
        gameInstance = new WordBlast('gameCanvas', 'easy');

        // Show/hide mobile controls based on screen size
        function checkMobile() {
            const mobileControls = document.getElementById('mobileControls');
            if (mobileControls) {
                if (window.innerWidth <= 768) {
                    mobileControls.style.display = 'flex';
                } else {
                    mobileControls.style.display = 'none';
                }
            }
        }

        checkMobile();
        window.addEventListener('resize', checkMobile);
    });
</script>
{% endblock %}